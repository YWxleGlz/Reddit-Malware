import urllib.parse
import re

f = open("2-stage-RWWDSRBQMOLKJYJKQWM.txt", "r")

unquote = urllib.parse.unquote(f.read())
unquote = unquote.replace("mid(", "Mid(")

output = ""

for line in unquote.splitlines():
    if "Replace" in line:
      elements = re.findall(r'([^=]+)=\s*Replace\(([^,]+),\s*"([^"]+)",\s*"([^"]+)"\)', line)

      # Extract text in [('ITPVFHBDBCNCPEBIERCQGNQFH', 'ITPVFHBDBCNCPEBIERCQGNQFH', 'AJIVWRTEVIQHHJSDIFTJTXKUA', '//')]

      output = output.replace(elements[0][2], elements[0][3])

    elif "Mid" in line:
       elements = re.findall(r'([^=]+) = Mid\(([^,]+),\s*(\d+),\s*(\d+)\)', line)
       begin = int(elements[0][2])-1
       end = begin + int(elements[0][3])
       
       for linec in unquote.splitlines():
          if elements[0][1] + " =" in linec :
            equal_sign_index = linec.find('=')
            extracted_string = linec[equal_sign_index + 3:-1]
           
            output += elements[0][0] + " = " + extracted_string[begin:end] + "\n"
            break 
          
    else:
       output += line + "\n"

f = open("2-stage-RWWDSRBQMOLKJYJKQWM-output.txt", "w")
f.write(output)
f.close()
